<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>★ Awesome Forum 2008 ★</title>
<style>
body{font-family:Verdana,Arial,sans-serif;font-size:12px;background:#E8E8E8;margin:0;padding:0;}
.header{background:linear-gradient(#4A90E2,#2E5C8A);color:#fff;padding:10px;text-align:center;}
.container{max-width:700px;margin:20px auto;padding:10px;background:#fff;border:1px solid #ccc;}
input,textarea,button{font-size:12px;}
.message{border-bottom:1px solid #ccc;padding:5px;margin-bottom:5px;}
.reply{margin-left:20px;border-left:2px solid #4A90E2;padding-left:5px;padding-top:3px;}
.admin-btn{margin-left:10px;background:red;color:#fff;border:none;cursor:pointer;font-size:10px;}
</style>
</head>
<body>
<div class="header">
  <h1>★ Awesome Forum 2008 ★</h1>
  <div id="welcome"></div>
</div>

<div class="container" id="auth">
<h3>Login / Register</h3>
<input id="username" placeholder="Username"><br><br>
<input id="email" placeholder="Email (register only)"><br><br>
<input id="password" type="password" placeholder="Password"><br><br>
<button onclick="login()">Login</button>
<button onclick="register()">Register</button>
<div id="error" style="color:red;margin-top:10px;"></div>
</div>

<div class="container" id="forum" style="display:none;">
<h3>Post New Message</h3>
<input id="title" placeholder="Subject"><br><br>
<textarea id="msg" placeholder="Message"></textarea><br><br>
<button onclick="postMessage()">Post</button>
<hr>
<h3>Messages</h3>
<div id="messages"></div>
</div>

<script>
const API='https://your-forum-api.onrender.com';
let currentUser=null;

function setWelcome(){document.getElementById('welcome').innerText=currentUser?'Welcome '+currentUser.username:'Please login';}

async function loadMessages(){
  const res=await fetch(`${API}/messages`);
  const data=await res.json();
  const msgDiv=document.getElementById('messages'); msgDiv.innerHTML='';
  const threads=(data.messages||[]).filter(m=>!m.replyTo);
  threads.forEach(t=>{
    const div=createMessageDiv(t,0);
    msgDiv.appendChild(div);
    renderReplies(div,t.id,data.messages||[],1);
  });
}

function createMessageDiv(msg,level){
  const div=document.createElement('div');
  div.className=level>0?'reply':'message';
  div.innerHTML=`<b>${msg.title}</b> by ${msg.username}: ${msg.message}`;
  if(currentUser?.username==='admin'){
    let btn=document.createElement('button'); btn.innerText='Delete'; btn.className='admin-btn';
    btn.onclick=()=>deleteMsg(msg.id); div.appendChild(btn);
  }
  return div;
}

function renderReplies(parentDiv,parentId,allMsgs,level){
  const replies=allMsgs.filter(m=>m.replyTo===parentId);
  replies.forEach(r=>{
    const rdiv=createMessageDiv(r,level);
    parentDiv.appendChild(rdiv);
    renderReplies(rdiv,r.id,allMsgs,level+1);
  });
}

async function login(){
  const u=document.getElementById('username').value;
  const p=document.getElementById('password').value;
  const res=await fetch(`${API}/login`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})});
  const d=await res.json();
  if(res.ok){currentUser=d;document.getElementById('auth').style.display='none';document.getElementById('forum').style.display='block';setWelcome();loadMessages();document.getElementById('error').innerText='';}
  else document.getElementById('error').innerText=d.error||'Login failed';
}

async function register(){
  const u=document.getElementById('username').value;
  const p=document.getElementById('password').value;
  const e=document.getElementById('email').value;
  const res=await fetch(`${API}/register`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p,email:e,joinDate:new Date().toISOString()})});
  const d=await res.json();
  if(res.ok){alert('Registered! Please login.');}
  else document.getElementById('error').innerText=d.error||'Register failed';
}

async function postMessage(){
  const t=document.getElementById('title').value||'No Subject';
  const m=document.getElementById('msg').value;
  if(!m)return alert('Message required');
  await fetch(`${API}/messages`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id:Date.now(),username:currentUser.username,title:t,message:m,timestamp:new Date().toISOString(),replyTo:null})});
  document.getElementById('title').value=''; document.getElementById('msg').value=''; loadMessages();
}

async function deleteMsg(id){
  await fetch(`${API}/messages/${id}?user=admin`,{method:'DELETE'});
  loadMessages();
}
</script>
</body>
</html>
